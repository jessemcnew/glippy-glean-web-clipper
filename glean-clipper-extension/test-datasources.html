<!doctype html>
<html>
  <head>
    <title>Test Glean Datasources</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
      }
      input,
      button {
        padding: 8px;
        margin: 4px;
      }
      .result {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
      }
      .error {
        background: #ffebee;
        color: #c62828;
      }
      .success {
        background: #e8f5e8;
        color: #2e7d32;
      }
    </style>
  </head>
  <body>
    <h2>Glean Datasource Checker</h2>

    <div>
      <input type="text" id="domain" placeholder="linkedin-be.glean.com" style="width: 300px" />
      <br />
      <input type="password" id="token" placeholder="Your API token" style="width: 300px" />
      <br />
      <button onclick="checkDatasources()">Check Available Datasources</button>
      <button onclick="testDocumentCount()">Test Document Count API</button>
    </div>

    <div id="results"></div>

    <script>
      async function testDocumentCount() {
        const domain = document.getElementById('domain').value || 'linkedin-be.glean.com';
        const token = document.getElementById('token').value;

        if (!token) {
          showResult('Please enter your API token', 'error');
          return;
        }

        try {
          const response = await fetch(`https://${domain}/api/index/v1/getdocumentcount`, {
            method: 'GET',
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
          });

          const data = await response.text();

          if (response.ok) {
            try {
              const json = JSON.parse(data);
              showResult(
                'Document Count Success! Available datasources:\n' + JSON.stringify(json, null, 2),
                'success'
              );

              // Extract datasource names if available
              if (json.datasourceDocumentCounts) {
                const datasources = json.datasourceDocumentCounts.map(d => d.datasource);
                showResult('Datasource names you can use:\n' + datasources.join('\n'), 'success');
              }
            } catch (e) {
              showResult('Response: ' + data, 'success');
            }
          } else {
            showResult(`Error ${response.status}: ${data}`, 'error');
          }
        } catch (error) {
          showResult('Network error: ' + error.message, 'error');
        }
      }

      async function checkDatasources() {
        const domain = document.getElementById('domain').value || 'linkedin-be.glean.com';
        const token = document.getElementById('token').value;

        if (!token) {
          showResult('Please enter your API token', 'error');
          return;
        }

        // Try to get datasource config for common names
        const commonNames = [
          'Webclipper',
          'WEBCLIPPER',
          'CUSTOMWEBCLIPPER',
          'Global',
          'Indiscovery',
        ];

        for (const dsName of commonNames) {
          try {
            const response = await fetch(`https://${domain}/api/index/v1/getdatasourceconfig`, {
              method: 'POST',
              headers: {
                Authorization: `Bearer ${token}`,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ datasource: dsName }),
            });

            const data = await response.text();

            if (response.ok) {
              showResult(`✅ ${dsName} exists!`, 'success');
            } else if (response.status === 400) {
              showResult(`❌ ${dsName} does not exist`, 'error');
            } else {
              showResult(`❓ ${dsName}: ${response.status} - ${data}`, 'result');
            }
          } catch (error) {
            showResult(`❓ ${dsName}: Network error`, 'error');
          }

          // Small delay between requests
          await new Promise(resolve => setTimeout(resolve, 200));
        }
      }

      function showResult(message, type) {
        const div = document.createElement('div');
        div.className = 'result ' + type;
        div.innerHTML = '<pre>' + message + '</pre>';
        document.getElementById('results').appendChild(div);
      }
    </script>
  </body>
</html>
