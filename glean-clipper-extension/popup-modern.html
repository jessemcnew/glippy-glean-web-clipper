<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Glean Clipper</title>
    <link rel="stylesheet" href="popup-modern.css" />
  </head>
  <body>
    <div class="popup-shell">
      <div class="popup-header">
        <div class="popup-title">Glean Clipper</div>
        <div id="clip-count" class="popup-subtitle">0 clips saved</div>
      </div>

      <nav class="popup-menu" role="navigation" aria-label="Glean Clipper actions">
        <button id="menu-save-collection" class="menu-item" aria-label="Save to Collection">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M7 4h10l3 4v11a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V4z" />
              <path d="M7 4v11a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4" />
            </svg>
            <span class="menu-label">Save to Collection</span>
          </span>
        </button>

        <button id="menu-save-url" class="menu-item" aria-label="Save URL (Command Option 0)">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M10 13a5 5 0 0 0 7.54.54l2-2a5 5 0 0 0-7.08-7.08l-1.75 1.75" />
              <path d="M14 11a5 5 0 0 0-7.54-.54l-2 2a5 5 0 0 0 7.08 7.08L12.75 18" />
            </svg>
            <span class="menu-label">Save URL</span>
          </span>
          <span class="menu-shortcut" aria-label="Keyboard shortcut">⌘ ⌥ 0</span>
        </button>

        <button id="menu-recent-clips" class="menu-item" aria-label="Recent Clips (Option 1)">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" />
            </svg>
            <span class="menu-label">Recent Clips</span>
          </span>
          <span class="menu-shortcut" aria-label="Keyboard shortcut">⌥ 1</span>
        </button>

        <button id="menu-prompts" class="menu-item" aria-label="Saved Prompts">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
            </svg>
            <span class="menu-label">Saved Prompts</span>
          </span>
        </button>

        <button id="menu-library" class="menu-item" aria-label="Library">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M6 4h12" />
              <path d="M6 20h12" />
              <rect x="6" y="8" width="12" height="8" rx="1" />
            </svg>
            <span class="menu-label">Library</span>
          </span>
        </button>

        <div class="menu-divider"></div>

        <button id="menu-capture-area" class="menu-item" aria-label="Capture Area (Option 2)">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="2" />
              <path d="M7 7h.01M17 7h.01M7 17h.01M17 17h.01" />
            </svg>
            <span class="menu-label">Capture Area</span>
          </span>
          <span class="menu-shortcut" aria-label="Keyboard shortcut">⌥ 2</span>
        </button>

        <button id="menu-capture-visible" class="menu-item" aria-label="Capture Visible (Option 3)">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <rect x="2" y="5" width="20" height="14" rx="2" />
              <path d="M6 9h12" />
            </svg>
            <span class="menu-label">Capture Visible</span>
          </span>
          <span class="menu-shortcut" aria-label="Keyboard shortcut">⌥ 3</span>
        </button>

        <button id="menu-capture-page" class="menu-item" aria-label="Capture Page (Option 4)">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M5 3h7l5 5v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" />
              <path d="M12 3v5h5" />
            </svg>
            <span class="menu-label">Capture Page</span>
          </span>
          <span class="menu-shortcut" aria-label="Keyboard shortcut">⌥ 4</span>
        </button>

        <div class="menu-divider"></div>

        <button id="menu-slack" class="menu-item" aria-label="Share to Slack">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M5 7.86C5 5.7 6.7 4 8.86 4h6.28C17.3 4 19 5.7 19 7.86v8.28C19 18.3 17.3 20 15.14 20H8.86C6.7 20 5 18.3 5 16.14V7.86z" />
              <path d="M9 12h6M12 9v6" />
            </svg>
            <span class="menu-label">Share to Slack</span>
          </span>
        </button>

        <button id="menu-preferences" class="menu-item menu-nav" aria-label="Preferences">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <circle cx="12" cy="12" r="3" />
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
            </svg>
            <span class="menu-label">Preferences</span>
          </span>
          <svg class="menu-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>

        <button id="menu-configuration" class="menu-item menu-nav" aria-label="Configuration">
          <span class="menu-left">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <path d="M12 3v18" />
              <path d="M6 9h12" />
              <path d="M6 15h12" />
            </svg>
            <span class="menu-label">Configuration</span>
          </span>
          <svg class="menu-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>
      </div>

      <!-- Hidden settings panel (slides open when configuration clicked) -->
      <div id="settings-panel" class="settings-drawer">
        <div class="settings-header">
          <div>
            <div class="settings-title">Configuration</div>
            <div class="settings-subtitle">Authenticate & choose collection</div>
          </div>
          <button id="settings-close" class="settings-close" aria-label="Close settings">✕</button>
        </div>

        <div class="settings-body">
          <!-- Authentication -->
          <div class="settings-card">
            <h3 class="settings-card-title">Step 1: Authentication</h3>
            <div class="form-group">
              <div class="form-hint strong-hint">
                <strong>Quick Setup:</strong><br />
                1. Glean → Admin → Platform → Token Management<br />
                2. Create a <strong>Client API token</strong><br />
                3. Paste it below
              </div>
              <button id="oauth-authenticate-btn" class="oauth-btn">Open Glean Token Page</button>
              <button id="manual-token-toggle" class="manual-toggle-btn">Or Enter Token Manually</button>
              <div id="token-input-group" class="token-input-group" style="display: none;">
                <label class="form-label">Client API Token</label>
                <input type="password" id="glean-client-token" class="form-input" placeholder="Paste your Client API token here" />
                <div class="form-hint">Get this from Glean Admin → Platform → Token Management → Client tab</div>
              </div>
              <div id="oauth-status" class="oauth-status" style="display: none;">
                ✅ Token saved
              </div>
            </div>
          </div>

          <!-- Default Collection -->
          <div class="settings-card">
            <h3 class="settings-card-title">Step 2: Select Collection</h3>
            <div class="form-group">
              <div class="collection-search-row">
                <input type="text" id="collection-search-input" class="form-input" placeholder="Search collections..." />
                <button id="clear-collection-btn" class="btn btn-secondary" style="display: none;">Clear</button>
              </div>
              <div id="collection-results" class="collection-results"></div>
              <select id="glean-collection-id" class="form-select" aria-hidden="true">
                <option value="">Select a collection...</option>
              </select>
              <div class="form-hint">Type to search collections. Click "Test Connection" first to load them.</div>
            </div>
          </div>

          <!-- Sync Toggle -->
          <div class="settings-card">
            <div class="sync-toggle-group">
              <label class="sync-toggle">
                <input type="checkbox" id="glean-enabled" />
                <span class="toggle-slider"></span>
                <span class="toggle-label">Sync clips to Glean</span>
              </label>
              <span id="connection-status" class="status-badge disconnected">Disconnected</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button id="save-settings" class="btn btn-primary">Save Settings</button>
            <div class="button-grid">
              <button id="test-connection" class="btn btn-success">Test Connection</button>
              <button id="test-sync" class="btn btn-secondary">Test Sync</button>
              <button id="open-debugger" class="btn btn-warning">Open Debugger</button>
            </div>
          </div>

          <!-- View Notebook -->
          <div class="notebook-section">
            <button id="view-notebook-btn" class="btn btn-notebook">View Notebook</button>
            <div class="notebook-hint">Search, sort, and explore all your clips</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden containers required by JS -->
    <div id="clips-container" style="display:none;"></div>
    <div id="empty-state" style="display:none;"></div>
    <button id="clip-to-glean-btn" style="display:none;"></button>
    <script type="module" src="popup.js"></script>

    <!-- Configuration window (light card style) -->
    <div id="config-window" class="config-window">
      <div class="config-header">
        <button id="config-back" class="config-back" aria-label="Back to main menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
            <path d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <div class="config-title">Preferences</div>
      </div>

      <div class="config-section">
        <div class="config-section-title">Interface Settings</div>
        <div class="config-cards">
          <label class="config-card">
            <input type="radio" name="theme-choice" value="light" checked />
            <div class="config-card-visual light"></div>
            <div class="config-card-label">Light</div>
          </label>
          <label class="config-card">
            <input type="radio" name="theme-choice" value="dark" />
            <div class="config-card-visual dark"></div>
            <div class="config-card-label">Dark</div>
          </label>
          <label class="config-card">
            <input type="radio" name="theme-choice" value="system" />
            <div class="config-card-visual system"></div>
            <div class="config-card-label">System</div>
          </label>
        </div>
        <div class="config-grid">
          <div class="config-grid-item">
            <div class="config-grid-label">Language</div>
            <div class="config-grid-value">English</div>
          </div>
          <div class="config-grid-item">
            <div class="config-grid-label">Mode</div>
            <div class="config-grid-value">Browser Language</div>
          </div>
        </div>
      </div>

      <div class="config-section">
        <div class="config-section-title">Collect Settings</div>
        <div class="config-cards wide">
          <label class="config-card">
            <input type="radio" name="collect-mode" value="popup" checked />
            <div class="config-card-visual popup"></div>
            <div class="config-card-label">Popup</div>
          </label>
          <label class="config-card">
            <input type="radio" name="collect-mode" value="bottom" />
            <div class="config-card-visual bottom"></div>
            <div class="config-card-label">Bottom</div>
          </label>
          <label class="config-card">
            <input type="radio" name="collect-mode" value="disabled" />
            <div class="config-card-visual disabled"></div>
            <div class="config-card-label">Disabled</div>
          </label>
        </div>
        <div class="config-toggle-row">
          <div>
            <div class="config-toggle-title">Ask where to save when saving images</div>
            <div class="config-toggle-sub">Categorize, tag, and rate images immediately upon saving.</div>
          </div>
          <label class="config-switch">
            <input type="checkbox" />
            <span class="config-switch-slider"></span>
          </label>
        </div>
        <div class="config-toggle-row">
          <div>
            <div class="config-toggle-title">Download through the browser</div>
            <div class="config-toggle-sub">Allows downloads that need login access.</div>
          </div>
          <label class="config-switch">
            <input type="checkbox" />
            <span class="config-switch-slider"></span>
          </label>
        </div>
      </div>

      <div class="config-section">
        <div class="config-section-title">Authentication</div>
        <div class="config-stack">
          <button id="config-token-page" class="config-primary">Open Token Page</button>
          <div class="config-input-row">
            <input type="password" id="config-token-input" class="config-input" placeholder="Client API token" />
            <button id="config-save" class="config-secondary">Save</button>
          </div>
          <button id="config-test" class="config-ghost">Test Connection</button>
          <div class="config-collections">
            <div class="config-section-title" style="margin-bottom:6px;">Collections</div>
            <div id="config-collections-list" class="config-collections-list">Loading collections...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slack Integration Modal -->
    <div id="slack-modal" class="slack-modal" style="display: none;">
      <div class="slack-modal-overlay" id="slack-modal-overlay"></div>
      <div class="slack-modal-content">
        <div class="slack-modal-header">
          <h2>Share to Slack</h2>
          <button class="slack-modal-close" id="slack-modal-close">×</button>
        </div>
        <div class="slack-modal-body">
          <div id="slack-connection-status" class="slack-status">
            <div class="slack-status-loading">Checking connection...</div>
          </div>
          <div id="slack-form" style="display: none;">
            <div class="slack-field">
              <label>Select Channel</label>
              <select id="slack-channel" class="slack-select">
                <option value="">Choose a channel...</option>
              </select>
            </div>
            <div class="slack-field">
              <label>Message (optional)</label>
              <textarea id="slack-message" class="slack-textarea" placeholder="Add a message to your clip..." rows="4"></textarea>
            </div>
            <button id="slack-share-btn" class="slack-share-btn" aria-label="Share to Slack channel">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;" aria-hidden="true">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
              </svg>
              <span>Share to Channel</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

