(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36730,(e,o,n)=>{o.exports=e.r(83198)},81653,e=>{"use strict";e.s(["default",()=>i]);var o=e.i(35197),n=e.i(58213),t=e.i(36730),r=e.i(32192);function i(){let e=(0,t.useRouter)(),{login:i}=(0,r.useAuth)(),[s,a]=(0,n.useState)("processing"),[c,l]=(0,n.useState)("");return(0,n.useEffect)(()=>{(async()=>{var o,n,t,r,s,c;try{let c=new URLSearchParams(window.location.search),d=c.get("code"),w=c.get("error");if(w){if(window.opener&&window.opener!==window){null==(o=window.opener)||o.postMessage({type:"GLEAN_OAUTH_ERROR",error:"OAuth error: ".concat(w)},window.location.origin),setTimeout(()=>window.close(),500);return}l("OAuth error: ".concat(w)),a("error");return}if(!d){if(window.opener&&window.opener!==window){null==(n=window.opener)||n.postMessage({type:"GLEAN_OAUTH_ERROR",error:"No authorization code received"},window.location.origin),setTimeout(()=>window.close(),500);return}l("No authorization code received"),a("error");return}let u=sessionStorage.getItem("oauth_domain")||"app.glean.com";sessionStorage.removeItem("oauth_domain");let p=u.replace(/^https?:\/\//,"").replace(/\/$/,"");p.includes("-be.glean.com")||"app.glean.com"===p||p.startsWith("app.")||p.endsWith(".glean.com")&&p.replace(".glean.com","");let m=p.includes("-be.")?p.replace("-be.glean.com",".glean.com"):p,h="".concat(window.location.origin,"/auth/callback"),g=await fetch("https://".concat(m,"/oauth/token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:d,redirect_uri:h,grant_type:"authorization_code"})});if(!g.ok){let e=await g.text(),o="Token exchange failed: ".concat(g.statusText," - ").concat(e);if(window.opener&&window.opener!==window){null==(t=window.opener)||t.postMessage({type:"GLEAN_OAUTH_ERROR",error:o},window.location.origin),setTimeout(()=>window.close(),500);return}throw Error(o)}let x=(await g.json()).access_token;if(!x){let e="No access token in response";if(window.opener&&window.opener!==window){null==(r=window.opener)||r.postMessage({type:"GLEAN_OAUTH_ERROR",error:e},window.location.origin),setTimeout(()=>window.close(),500);return}throw Error(e)}window.opener&&window.opener!==window?(null==(s=window.opener)||s.postMessage({type:"GLEAN_OAUTH_SUCCESS",token:x,domain:p},window.location.origin),a("success"),setTimeout(()=>{window.close()},500)):(i({domain:p,apiToken:x,authMethod:"oauth"}),a("success"),setTimeout(()=>{e.push("/")},1e3))}catch(o){console.error("OAuth callback error:",o);let e=o instanceof Error?o.message:"Failed to complete OAuth flow";if(window.opener&&window.opener!==window){null==(c=window.opener)||c.postMessage({type:"GLEAN_OAUTH_ERROR",error:e},window.location.origin),setTimeout(()=>window.close(),500);return}l(e),a("error")}})()},[i,e]),(0,o.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center px-4",children:(0,o.jsxs)("div",{className:"max-w-md w-full bg-zinc-900 rounded-lg border border-zinc-800 shadow-lg p-8 text-center",children:["processing"===s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,o.jsx)("h2",{className:"text-xl font-bold text-zinc-100 mb-2",children:"Completing sign in..."}),(0,o.jsx)("p",{className:"text-zinc-400",children:"Processing OAuth callback"})]}),"success"===s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"text-green-500 text-5xl mb-4",children:"✓"}),(0,o.jsx)("h2",{className:"text-xl font-bold text-zinc-100 mb-2",children:"Sign in successful!"}),(0,o.jsx)("p",{className:"text-zinc-400",children:"Redirecting to dashboard..."})]}),"error"===s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"✗"}),(0,o.jsx)("h2",{className:"text-xl font-bold text-zinc-100 mb-2",children:"Sign in failed"}),(0,o.jsx)("p",{className:"text-zinc-400 mb-4",children:c}),(0,o.jsx)("button",{onClick:()=>e.push("/"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Return to Login"})]})]})})}}]);